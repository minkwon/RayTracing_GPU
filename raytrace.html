<!DOCTYPE html>
<html lang="en">
<head>
    <script src="js/gpu.min.js"></script>
    <script src="js/three.js"></script>
    <script src="js/helper.js"></script>
    <script src="js/scene.js"></script>
    <script src="js/raytracer.js"></script>
    <link rel="stylesheet" type="text/css" href="styleGenerator.css">
    <meta charset="UTF-8">
    <title>Ray tracing with javascript using GPU.js</title>
</head>
<body>

<input type="button" value="Using GPU" onclick="return changeMode(this);" />
<div id = "fps"></div>
<div id = "mode" mode = "gpu"></div>
<script>

    // configurations

    var IMAGE_WIDTH = 300;
    var IMAGE_HEIGHT = 300;
    // must evenly divide image pixel!
    var ROWS = 4;
    var COLUMNS = 4;

    var gpu = new GPU();
    // helper functions to be used inside the kernel
    gpu.addFunction(lightIsBlockedByObject);
    gpu.addFunction(getVectorLength);
    gpu.addFunction(dotProduct);

    // info is an array that contains unit vectors for the camera
    // it also contains the width/height of the image and pixel
    // These values are shared between all rays so it is calculated
    // serially.
    // at index:
    // 0,1,2: camera's directional vector x, y, z
    // 3,4,5: camera's right vector x, y, z
    // 6,7,8: camera's up vector x, y, z
    // 9, 10: width, height of image
    // 11,12: width, height of each pixel
    var info = getPerspectiveInfo(camera);

    for (var row = 0; row < ROWS; row++) {
        for (var col = 0; col < COLUMNS; col++) {
            var arg = [gpu, row, col, ROWS, COLUMNS, IMAGE_WIDTH, IMAGE_HEIGHT];
            rayTrace(arg, info);
        }
    }

</script>

</body>
</html>